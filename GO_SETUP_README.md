# Исправление проблем с Go Inlay Hints и подсветкой

## Проблемы которые были решены:

1. ❌ **Ошибка**: `E5101: Cannot convert given Lua type` в функции `EnableGoInlayHints`
2. ❌ **Проблема**: Пропала подсветка переменных в Go файлах
3. ❌ **Проблема**: Не работают inlay hints (подсказки типов)

## Что было исправлено:

### 1. Удалены конфликтующие файлы:
- `plugin/force_go_inlay_hints.vim` (вызывал ошибку E5101)
- `plugin/inlay_hints.lua` (конфликтовал с основной конфигурацией)

### 2. Обновлена конфигурация LSP (`lua/plugins/lsp.lua`):
- Включены все типы inlay hints для gopls
- Отключены семантические токены, которые мешали подсветке
- Добавлен правильный `on_attach` для gopls
- Добавлен маппинг `<leader>th` для переключения hints

### 3. Обновлен `ftplugin/go.vim`:
- Современный API для inlay hints
- Функция восстановления подсветки синтаксиса
- Автоматическое включение hints при открытии Go файлов
- Новые команды и маппинги

### 4. Улучшен `custom_go_inlay_hints.lua`:
- Использует современный API Neovim 0.10+
- Безопасное включение hints с проверками
- Команды для диагностики и исправления

## Как использовать:

### Автоматически:
Inlay hints должны включаться автоматически при открытии Go файлов.

### Команды для ручного управления:
```vim
:GoEnableInlayHints     " Включить inlay hints
:GoCheckInlayHints      " Проверить статус
:GoRestartLspHints      " Перезапустить gopls с hints
:GoFixHighlighting      " Исправить подсветку и hints
```

### Горячие клавиши:
- `<leader>th` - переключить inlay hints
- `<leader>ih` - включить inlay hints для всех Go буферов
- `<leader>gf` - исправить все проблемы с подсветкой и hints
- `<leader>gh` - включить hints для текущего буфера
- `<leader>gs` - восстановить подсветку синтаксиса

### Диагностика:
```vim
:luafile fix_go_setup.lua
```
Этот скрипт проверит состояние LSP, inlay hints и выполнит автоматические исправления.

## Тестирование:

1. Откройте файл `test_inlay_hints.go`
2. Должны появиться подсказки типов для переменных
3. Должны показываться имена параметров в вызовах функций
4. Подсветка синтаксиса должна работать корректно

## Если проблемы остались:

1. `:GoRestartLspHints` - перезапустить gopls
2. `:LspRestart gopls` - полный перезапуск LSP
3. Перезапустить Neovim
4. Проверить версию Neovim (требуется 0.10+ для inlay hints)

## Настройки gopls:

В конфигурации включены все типы hints:
- `assignVariableTypes` - типы переменных
- `compositeLiteralFields` - поля структур
- `compositeLiteralTypes` - типы литералов
- `constantValues` - значения констант  
- `functionTypeParameters` - параметры функций
- `parameterNames` - имена параметров
- `rangeVariableTypes` - типы в range циклах

Семантические токены отключены для избежания конфликтов с подсветкой.